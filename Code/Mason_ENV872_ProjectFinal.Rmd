---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Changes on the Elwha River During Dam Removal"
subtitle: "https://github.com/kfm20/DataProject_ElwhaRiver.git"
author: "Kathleen Mason"
fontsize: 12pt
mainfont: Times New Roman
fig_width: 5
fig_height: 2.5
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
setwd("/Users/kathleenmason/Documents/DUKE/Data Analytics/ElwhaRiver/DataProject_ElwhaRiver")
getwd()

# Load your packages
library(tidyverse)
library(viridis)
library(ggplot2)
library(ggrepel)
library(scales)

# Set your ggplot theme
mytheme <- theme_light(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
theme_set(mytheme)


# Load your datasets
USGS_ElwhaRiverDischarge<-read.csv("./Processed/USGS_ElwhaRiver_processed.csv")
USGS_ElwhaRiverDischarge$Date<- as.Date(USGS_ElwhaRiverDischarge$Date, format = "%Y-%m-%d")
class(USGS_ElwhaRiverDischarge$Date)
USGS_ElwhaRiverDischarge_TimeStamp<-read.csv("./Processed/USGS_ElwhaRiverDischarge_TimeStamped_processed.csv")
USGS_ElwhaRiverDischarge_During<-read.csv("./Processed/USGS_ElwhaRiverDischarge_During_processed.csv")
USGS_ElwhaRiverDischarge_After<-read.csv("./Processed/USGS_ElwhaRiverDischarge_After_processed.csv")
```


# Rationale and Research Questions



\newpage

# Dataset Information



\newpage

# Exploratory Analysis 

An initial exploratory analysis is conducted to see general trends in data related to water and sediment discharge, and suspended concentrations in Elwha River during and after the dam removal process. Daily water discharge from the river, *Figure 1*, appears to have higher peaks of discharge in 2015 and 2016, the years after the dam removal project was complete. Embedding the dates involved with the dam removal process, such as start of removal, and completion of each dam removal will help differentiate differences in discharge related to more open flows with dams removed. This data might need to be looked at a different scale, instead of daily, maybe monthly averages will show a different relationship, or a similar one at a different magnitude. 

```{r Exploratory Analysis Figure 1, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily water discahrge of the Elwha River, WA, from September 15, 2011 to September 30, 2016."}
#1 Daily Discharge/time

ggplot(USGS_ElwhaRiverDischarge) +
  geom_point(aes(x = Date, y = DailyDischarge), size=1.25, color="skyblue4")+
  ylab(expression(Daily~Discharge~(m^2/s)))+
  scale_x_date(date_breaks = "1 year", labels = date_format("%Y"))+
  mytheme
```


```{r Exploratory Analysis Figure 2, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily suspended sediment in the Elwha River, WA, from September 15, 2011 to September 30, 2016."}
#2 Daily Suspended Sediment/time
ggplot(USGS_ElwhaRiverDischarge) +
  geom_point(aes(x = Date, y = DailySuspendedSediment), size=1, color="slateblue")+
  ylab("Daily Suspended Sediment (tonnes)")+
  scale_x_date(date_breaks = "1 year", labels = date_format("%Y"))+
  mytheme

```


```{r Exploratory Analysis Figure 3, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily suspended sediment of fine-grained particles in the Elwha River, WA, from September 15, 2011 to September 30, 2016."}
#3 DAily SSfine/time
ggplot(USGS_ElwhaRiverDischarge) +
  geom_point(aes(x = Date, y = DailySSfines), size=1, color="slateblue")+
  ylab("Daily Suspended Fine-Grained Sediment (tonnes)")+
  scale_x_date(date_breaks = "1 year", labels = date_format("%Y"))+
  mytheme
```


```{r Exploratory Analysis Figure 4, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily suspended sediment of sand particles in the Elwha River, WA, from September 15, 2011 to September 30, 2016."}
#4 Daily SSsand/time
ggplot(USGS_ElwhaRiverDischarge) +
  geom_point(aes(x = Date, y = DailySSsand), size=1, color="gray20")+
  ylab("Daily Suspended Sand Sediment (tonnes)")+
   scale_x_date(date_breaks = "1 year", labels = date_format("%Y"))+
  mytheme
```


```{r Exploratory Analysis Figure 5, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily suspended sediment of fine-grained particles (blue)  and sand particles (gray) in the Elwha River, WA, from September 15, 2011 to September 30, 2016."}
#5 SSsand and SSfine
ggplot(USGS_ElwhaRiverDischarge) +
  geom_point(aes(x = Date, y = DailySSfines), size=1, color="royalblue", alpha=0.25)+
  geom_point(aes(x = Date, y = DailySSsand), size=1, color="gray20", alpha=0.25)+
  ylab("Daily Suspended Sediment(tonnes)")+
  scale_x_date(date_breaks = "1 year", labels = date_format("%Y"))+
  mytheme
```

Suspended sediment concentrations might give a sense of the velocity of the flow heading downstream, and how much sand was stuck behind the dams that is then in movement after their removal. Looking at suspended concentrations over time may show how long it takes for the sediment behind the dam to resettle in the river, allowing the river to reach a new morphological norm. General trends of suspended sediments, *Figure 2*, show more tonnes happening around the year 2013, which is during the removal of the Elwha Dam, and the Glines Canyon Dam had already been removed. However, there still exists some high recordings of suspended sediment later on through the project years. However, these might have to do with the high water discharge. Further analysis will compare the relationship between daily suspended sediment and water discharge over time. The dataset also has daily suspended sediment of fine-grained particles, and sand particles. Their general point plots are shown individually, *Figures 3 and 4* and together in one plot, *Figure 5*, where we see there doesn't appear to be much difference between the makeup of the suspended sediment, although a further test can prove this. 

```{r Exploratory Analysis Figure 6, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily total sediment discharge from the Elwha River, WA, from September 15, 2011 to September 30, 2016."}
#6 Total sediment discharge/time
ggplot(USGS_ElwhaRiverDischarge) +
  geom_line(aes(x = Date, y = TotalSedimentDischarge), size=.5, color="royalblue")+
  ylab("Total Sediment Discharge (tonnes)")+
   scale_x_date(date_breaks = "1 year", labels = date_format("%Y"))+
  mytheme
```


```{r Exploratory Analysis Figure 7, echo=FALSE, message=FALSE, warning=FALSE, fig.cap= "Daily total sediment discharge and water discharge on the Elwha River, with a linear model, from September 15, 2011 to September 30, 2016."}
#7 daily discharge (water)/total sediment discharge

ggplot(USGS_ElwhaRiverDischarge, aes(DailyDischarge, TotalSedimentDischarge)) +
  geom_smooth(method='lm', formula=y~x, color="gray20")+
  geom_point(color="slateblue", size=1, alpha=0.5)+
  ylab("Total Sediment Discharge (tonnes)")+
  xlab(expression(Daily~Discharge~(m^2/s)))+
  ylim(0,NA)+
  xlim(0, NA)+
  mytheme
```

While there are multiple parameters highlighting the sediment traveling downstream, daily sediment discharge is a straight forward parameter of moving sediment in the Elwha River during and after the dam removal processes. From a general line plot of total sediment discharge over time, *Figure 6*, shows a peak discharge in 2013 and multiple large peaks as well as what appears like a larger avergae sediment discharge happening after 2014. These seem to make sense with the time stamps of the dam removal process, but combining the time stamps and this relationship in one graph will help better visualize the relationship with dam removal over time. Calculations of yearly averages of total sediment discharge will also be useful to determine if they are increasing from 2012 to 2016 like they appear to be in this figure. 

With daily water discharge and total sediment discharge being important parameters for showing changes in the Elwha River following dam removal, the relationship between them was graphed with a linear model to show a relationship. It makes sense that increased flow would generate increased sediment discharge, which we see from the positive linear relationship. It would be interesting to see this relationship graphed out for each individual year and see how this relationship might change. 



\newpage


# Analysis



## Question 1: How does water and sediment discharge in the Elwha River differ during and after the two part dam removal process?

A closer look into total sediment discharge and daily discharge of water from the Elwha River with attention on the time stamps of when the dam removal project begigs, and when it is completed, *Figures 8 and 9*, prompted an in depth analysis of trends. Data was separated into during the dam removal process and after its completion, September 26, 2014.

```{r Intro to Question (Figure 8), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily water discharge from the Elwha River from September 15, 2011 to September 30, 2016 measured at the U.S. Geological Survey gaging station 12046260 at the diversion near Port Angeles, Washington. A project to remove the Elwha and Glines Canyon Dam began on September 15, 2011, and was completed on August 26, 2014. Mean Daily discharge across the whole time range was 47.7."}

d=data.frame(date=as.Date(c("2011-09-15", "2014-08-26")), event=c("Dam Removal Project Begins", "Dam Removal Project Complete"))



myplot<-ggplot(USGS_ElwhaRiverDischarge)+
  geom_line(aes(x = Date, y = DailyDischarge), size=.4) +
geom_vline(data=d, mapping=aes(xintercept=date), color="skyblue4", lty=5, size=.5)+
  geom_hline(yintercept = 47.7, lty=3, color="sienna3", size=.7)+
  geom_text(data=d, mapping=aes
            (x=date, y=200, label=event), 
            size=2, angle=90, vjust=-0.4, hjust=0, color= "skyblue4", fontface="bold")+
  geom_text(x= as.Date("2015-11-01"), y=20, size = 2, label= "Mean Daily Discharge", color= "sienna3", vjust=-0.4, hjust=0, fontface="bold")+
  mytheme+
  ylab(expression(Daily~Water~Discharge~(m^2/s)))+
  xlab("Date")+
  theme(axis.title.y = element_text(size = rel(.75), angle = 90))+
  theme(axis.title.x = element_text(size= rel(.75)))
  print(myplot)

```

```{r Intro to Question (Figure 9), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily total sediment discharge from the Elwha River from September 15, 2011 to September 30, 2016 measured at the U.S. Geological Survey gaging station 12046260 at the diversion near Port Angeles, Washington. A project to remove the Elwha and Glines Canyon Dam began on September 15, 2011, and was completed on August 26, 2014. Mean Daily sediment discharge across the whole time range was 9886.876 tonnes."}

d=data.frame(date=as.Date(c("2011-09-15", "2014-08-26")), event=c("Dam Removal Project Begins", "Dam Removal Project Complete"))



myplot2<-ggplot(USGS_ElwhaRiverDischarge)+
  geom_line(aes(x = Date, y = TotalSedimentDischarge), size=.4) +
geom_vline(data=d, mapping=aes(xintercept=date), color="skyblue4", lty=5, size=.5)+
  geom_hline(yintercept = 9886.876, lty=3, color="sienna3", size=.7)+
  geom_text(data=d, mapping=aes
            (x=date, y=100000, label=event), 
            size=2, angle=90, vjust=-0.4, hjust=0, color= "skyblue4", fontface="bold")+
  geom_text(x= as.Date("2016-05-01"), y=20, size = 2, label= "Mean Total \nSediment \nDischarge", color= "sienna3", vjust=-0.4, hjust=0, fontface="bold")+
  mytheme+
  ylab("Total Daily Sediment Discharge (tonnes)")+
  xlab("Date")+
  theme(axis.title.y = element_text(size = rel(.75), angle = 90))+
  theme(axis.title.x = element_text(size= rel(.75)))
  print(myplot2)

```


A two sample t-test revealed...

```{r Two Way T-Test REsults Water (Figure 10), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily water discharge distribution during and after the Elwha River two dam removal process. During the dam removal is classified by dates from September 15, 2011 to August 26, 2014, and after is from then until September 30, 2016."}

ggplot(USGS_ElwhaRiverDischarge_TimeStamp) +
geom_boxplot(aes(x = TimeStamp, y = DailyDischarge), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
   ylab(expression(Daily~Water~Discharge~(m^2/s)))+
  mytheme

```


```{r Two Way T-Test REsults sediment(Figure 11), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily total sediment discharge distribution during and after the Elwha River two dam removal process. During the dam removal is classified by dates from September 15, 2011 to August 26, 2014, and after is from then until September 30, 2016."}

ggplot(USGS_ElwhaRiverDischarge_TimeStamp) +
geom_boxplot(aes(x = TimeStamp, y = TotalSedimentDischarge), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam Removal Process")+
  ylab("Total Daily Sediment \nDischarge (tonnes)")+
  mytheme

```

\newpage

## Question 2: Can we predict sediment discharge from water flow on the Elwha River?

Increased water flow on a river should carry more sediment, producing more overal sediment discharge. An analysis of water discharge and sediment discharge is performed over the entirity of the sampling period to find a general trend of the relationship of these two parameters over time on the Elwha. 

```{r Linear Regression (figure 12), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Daily water discharge as an indicator for daily total sediment discharge on the Elwha River, with a linear regression."}
dischargebywaterflow <-
ggplot(USGS_ElwhaRiverDischarge_TimeStamp, 
       aes(x = DailyDischarge, y = TotalSedimentDischarge)) + 
geom_point( alpha=0.5)+
  geom_smooth(method = 'lm', se = FALSE, color = "skyblue")+
  xlab(expression(Daily~Water~Discharge~(m^2/s)))+
  ylab("Daily Total Sediment \nDischarge (tonnes)")
print(dischargebywaterflow)
```

A linear regression revealed...


##Question 3: Does daily water discharge predict total sediment discharge during and after the two part dam removal process?

```{r Linear During (Figure 13), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="x"}
dischargebywaterflow_during <-
ggplot(USGS_ElwhaRiverDischarge_During, 
       aes(x = DailyDischarge, y = TotalSedimentDischarge)) + 
geom_point( alpha=0.5)+
  geom_smooth(method = 'lm', se = FALSE, color = "skyblue")+
  xlab(expression(Daily~Water~Discharge~(m^2/s)))+
  ylab("Daily Total Sediment \nDischarge (tonnes)")
print(dischargebywaterflow_during)
```


```{r Linear After (Figure 14), echo=FALSE, message=FALSE, warning=FALSE, fig.cap="x"}

dischargebywaterflow_after <-
ggplot(USGS_ElwhaRiverDischarge_After, 
       aes(x = DailyDischarge, y = TotalSedimentDischarge)) + 
geom_point( alpha=0.5)+
  geom_smooth(method = 'lm', se = FALSE, color = "skyblue")+
  xlab(expression(Daily~Water~Discharge~(m^2/s)))+
  ylab("Daily Total Sediment \nDischarge (tonnes)")
print(dischargebywaterflow_after)

```


\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
